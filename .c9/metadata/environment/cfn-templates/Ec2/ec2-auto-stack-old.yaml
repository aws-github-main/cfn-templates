{"changed":true,"filter":false,"title":"ec2-auto-stack-old.yaml","tooltip":"/cfn-templates/Ec2/ec2-auto-stack-old.yaml","value":"# Author: Birju Patel\n\nMappings:\n  RegionMap:\n    us-east-1:\n      AMI: ami-1853ac65\n    us-west-1:\n      AMI: ami-bf5540df\n    eu-west-1:\n      AMI: ami-3bfab942\n    ap-southeast-1:\n      AMI: ami-e2adf99e\n    ap-southeast-2:\n      AMI: ami-43874721\nMetadata:\n  AWS::CloudFormation::Interface:\n    -\n      Label: Key Pair\n      Parameters: \n        -KeyName\n      \n      Label: Vpc Id\n      Parameters:\n        - VpcId\n      Label: Select Subnet\n        - SubnetIds\nParameters:\n  KeyName:\n    Type: AWS::EC2::KeyPair::KeyName\n    Description: Ec2 Key Pair\nResources:\n  cVpc:\n    Type: AWS::EC2::Vpc\n    Properties:\n      CidrBlock: 173.0.0.0/16\n      EnableDnsHostnames: true\n      EnableDnsSupport: true\n      InstanceTenancy: default\n      Tags:\n        - Key: Name\n          Value: cfn-vpc\n  cSubnet:\n    Type: AWS::EC2:Subnet\n    Properties:\n      AvailabilityZone: us-east-1a\n      CidrBlock: 173.0.1.0/28\n      VpcId: !Ref cVpc\n      Tags:\n        - Key: Name\n          Value: cfn-pub-subnet-us-east-1a\n  cInternetGateway:\n    Type: AWS::EC2::InternetGateway\n    Properties:\n      Tags:\n        - Key: Name\n          Value: cfn-internet-gateway\n  cRouteTable:\n    Type: AWS::EC2::RouteTable\n    Properties:\n      VpcId: !Ref cVpc\n      Tags:\n        - Key: Name\n          Value: cfn-route-table\n  cRoute1:\n    Type:  AWS::EC2::Route\n    Properties:\n      DestinationCidrBlock: 0.0.0.0/0\n      RouteTableId: !Ref cRouteTable\n      GatewayId: !Ref cInternetGateway\n  cSubnetRouteTableAssoc:\n    Type: AWS::EC2::SubnetRouteTableAssociation\n    Properties:\n      RouteTableId: !Ref cRouteTable\n      SubnetId: !Ref cSubnet\n  cInstanceSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: cfn-EC2 Security Group\n      Tags:\n        - Key: Name\n          Value: cfn-ec2-sg-webserver\n      VpcId: !Ref VpcId\n  cAlbSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: cfn-alb-sg\n      VpcId: !Ref VpcId\n      Tags:\n        - Key: Name\n          Value: cfn-alb-sg\n  cSGInboundRule:\n    Type: AWS::EC2::SecurityGroupIngress\n    Properties:\n      IpProtocol: tcp\n      ToPort: 80\n      FromPort: 80\n      GroupId: !GetAtt cInstanceSecurityGroup.GroupId\n      SourceSecurityGroupId: !GetAtt cAlbSecurityGroup.GroupId\n  cAlbInboundRule:\n    Type: AWS::EC2::SecurityGroupIngress\n    Properties:\n      GroupId: !GetAtt cAlbSecurityGroup.GroupId\n      IpProtocol: tcp\n      ToPort: 80\n      FromPort: 80\n      CidrIp: 0.0.0.0/0\n  cLaunchConfiguration:\n    Type: AWS::AutoScaling::LaunchConfiguration\n    Metadata:\n      AWS::CloudFormation::Init:\n        config:\n          packages:\n            yum:\n              httpd: []\n              php: []\n          files:\n            /var/www/html/index.php:\n              content: !Sub |\n                <?php print \"This is a php server home page!\"; ?>\n          services:\n            sysvinit:\n              httpd:\n                ensureRunning: true\n                enabled: true\n    Properties:\n      AssociatePublicIpAddress: true\n      ImageId: \n        !FindInMap\n          - RegionMap\n          - !Ref AWS::Region\n          - AMI\n      InstanceType: t2.micro\n      SecurityGroups: \n        - !Ref cInstanceSecurityGroup\n      KeyName: !Ref KeyName\n      UserData:\n        Fn::Base64:\n          !Sub |\n            #!/bin/bash -xe\n            # ensure ec2 is up to date\n            yum update -y aws-cfn-bootstrap\n            #install meta data \n            /opt/aws/bin/cfn-init -v --stack ${AWS::StackName} --resource cLaunchConfiguration  --region ${AWS::Region}\n            #files have installed.\n  cLoadBalancer:\n    Type: AWS::ElasticLoadBalancingV2::LoadBalancer\n    Properties: \n      IpAddressType: ipv4\n      SecurityGroups:\n        - !Ref cAlbSecurityGroup\n      Subnets: !Ref SubnetIds\n      Tags:\n        - Key: Name\n          Value: cfn-alb-ec2\n  cTargetGroup:\n    Type:  AWS::ElasticLoadBalancingV2::TargetGroup\n    Properties:\n      Port: 80\n      Protocol: HTTP\n      Tags:\n        - Key: Name\n          Value: cfn-target-group\n      VpcId: !Ref VpcId\n  cLoadBalancerListener:\n    Type:  AWS::ElasticLoadBalancingV2::Listener\n    Properties:\n      DefaultActions:\n        - Type: forward\n          TargetGroupArn: !Ref cTargetGroup\n      LoadBalancerArn: !Ref cLoadBalancer\n      Port: 80\n      Protocol: HTTP\n      \n  cAutoScalingGroup:\n    Type: AWS::AutoScaling::AutoScalingGroup\n    Properties:\n      AvailabilityZones: !GetAZs\n      LaunchConfigurationName: !Ref cLaunchConfiguration\n      MaxSize: 2\n      MinSize: 2\n      Tags:\n        - \n          Key: Name\n          Value: cfn-asg-webserver\n          PropagateAtLaunch: 'true'\nOutputs:\n  oPublicDnsName:\n    Description: ALB-Ec2-cfn DnsName\n    Value: !Sub |\n      'http://${cLoadBalancer.DNSName}'","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":29,"column":29},"end":{"row":30,"column":2},"action":"remove","lines":["","  "],"id":1034}]]},"ace":{"folds":[],"scrolltop":1920,"scrollleft":0,"selection":{"start":{"row":29,"column":29},"end":{"row":29,"column":29},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":153,"state":"start","mode":"ace/mode/yaml"}},"timestamp":1576107058480}